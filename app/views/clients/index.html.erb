<% sum = 0 %>
<% @clients.each do |client| %>
    <% if client.billing_start_date.year == 2014 %>
        <% calc = (((2015 * 12 + 1) - (client.billing_start_date.year * 12 + client.billing_start_date.month)) * client.price.cost) %>
        <% sum += calc %>
        <% calc %>
    <% end %>
<% end %>

<% sum2 = 0 %>
<% @clients.each do |client| %>
    <% if client.billing_start_date.year == 2015 %>
        <% calc = (((2016 * 12 + 1) - (client.billing_start_date.year * 12 + client.billing_start_date.month)) * client.price.cost) %>
        <% sum2 += calc %>
        <% calc %>
    <% end %>
<% end %>

<% sum3 = 0 %>
<% @clients.each do |client| %>
    <% if client.billing_start_date.year == 2014 %>
        <% calc = (client.price.cost * 12) %>
        <% sum3 += calc %>
        <% calc %>
    <% end %>
<% end %>

<% sum4 = 0 %>
<% @clients.each do |client| %>
  <% if client.billing_start_date.year == 2014 %>
    <% calc = (client.price.cost * 12) %>
    <% sum4 += calc %>
    <% calc %>
  <% end %>
<% end %>

<div class="container">
<br>
<h1>Advantage Clients as of: <%= @now %> PST</h1> 



<div class="alert alert-info alert-dismissable">
  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
  <strong>UPDATES: </strong> search is now case insensitive; results-per-page pull down works again; and default sort is by launch date!
</div>

<table class="table table-striped table-hover">
<thead>
  <th>2014</th>
  <th>2015</th>
</thead>
<tbody>
  <tr>
    <td>Clients: <strong><%= Client.where("extract(year from launch_date) = ?", 2014).count %></strong></td>
    <td>Clients: <strong><%= Client.where("extract(year from launch_date) = ?", 2015).count %></strong></td>
  </tr>
  <tr>
    <td>2014 Revenue: <strong>$<%= number_with_delimiter(sum, :delimiter => ',') %></strong></td>
    <td>New Revenue in 2015: <strong>$<%= number_with_delimiter(sum2, :delimiter => ',') %></strong></td>
  </tr>
  <tr>
    <td>2014 Revenue (if full year): <strong>$<%= number_with_delimiter(sum4, :delimiter => ',') %></strong></td>
    <td>Total Revenue in 2015: <strong>$<%= number_with_delimiter(sum3 + sum2, :delimiter => ',') %></strong></td>
  </tr>
</tbody>








  <div class="btn-group"><% if can? :new, @client %>
    <button type="button" class="btn btn-default btn">
      <%= link_to 'New Client', new_client_path %>
    </button><% end %>
    <button type="button" class="btn btn-default btn">
      <%= link_to "Export XLS", clients_path(format: "xls") %>
    </button>
  <br>
  </div>
</div>

<div class="container">
<table id="clients" class="table table-striped table-reponsive display" data-source="<%= clients_url(format: "json") %>">
  <thead>
    <tr>
      <th>Client Name</th>
      <th>Launch Date</th>
      <th>Price Per Month</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

<br>
<% if can? :new, @client %>
<%= link_to 'New Client', new_client_path %>
<% end %>
</div>


